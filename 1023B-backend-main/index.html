<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="style.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0&icon_names=sports_basketball" />
  <title>Atletas</title>
</head>
<body>
  <header>
    <span class="material-symbols-outlined">sports_basketball</span>
    <h1>CADASTRE SEU ATLETA</h1>
    <nav>
      <a href="index.html">ATLETAS</a>
      <a href="cadastro.html">CADASTRE</a>
      <a href="comparar.html">COMPARAR</a>
      <a href="destaques.html">DESTAQUES</a>
      <a href="listar.html">LISTA</a>
    </nav>
  </header>


    <h2>Atletas Cadastrados</h2>
    <div id="area-graficos"></div>

    <script>
   const todosOsGraficos = [];

function criarGrafico(atleta) {
    const area = document.getElementById("area-graficos");

    const cartaContainer = document.createElement("div");
    cartaContainer.className = "atleta-carta";

    const infoTexto = document.createElement("div");
    infoTexto.className = "atleta-info";
    infoTexto.innerHTML = `
        <p><strong>ID:</strong> ${atleta.id}</p>
        <p><strong>Nome:</strong> ${atleta.nome}</p>
        <p><strong>Idade:</strong> ${atleta.idade}</p>
        <p><strong>Altura:</strong> ${atleta.altura} m</p>
    `;

    const canvasContainer = document.createElement("div");
    canvasContainer.className = "grafico-container";
    const canvas = document.createElement("canvas");

    canvasContainer.appendChild(canvas);
    cartaContainer.appendChild(infoTexto);
    cartaContainer.appendChild(canvasContainer);
    area.appendChild(cartaContainer);

    const ctx = canvas.getContext("2d");

    const dados = [
        parseInt(atleta.forca) || 0,
        parseInt(atleta.resistencia) || 0,
        parseInt(atleta.velocidade) || 0,
        parseInt(atleta.impulsao) || 0,
        parseInt(atleta.arremesso) || 0
    ];

    // Salvar dados para a média depois
    todosOsGraficos.push({ nome: atleta.nome, data: dados });

    new Chart(ctx, {
        type: "radar",
        data: {
            labels: ["Força", "Resistência", "Velocidade", "Impulsão", "Arremesso"],
            datasets: [{
                label: atleta.nome,
                data: dados,
                backgroundColor: "rgba(54, 162, 235, 0.2)",
                borderColor: "rgba(54, 162, 235, 1)",
                pointBackgroundColor: "rgba(54, 162, 235, 1)"
            }]
        },
        options: {
            responsive: true,
            scales: {
                r: {
                    min: 1,
                    max: 5,
                    ticks: { stepSize: 1 }
                }
            }
        }
    });
}

function criarGraficoMedia(nome, dados, canvas) {
    const ctx = canvas.getContext("2d");

    new Chart(ctx, {
        type: "radar",
        data: {
            labels: ["Força", "Resistência", "Velocidade", "Impulsão", "Arremesso"],
            datasets: [{
                label: nome,
                data: dados,
                backgroundColor: "rgba(255, 99, 132, 0.2)",
                borderColor: "rgba(255, 99, 132, 1)",
                pointBackgroundColor: "rgba(255, 99, 132, 1)"
            }]
        },
        options: {
            responsive: true,
            scales: {
                r: {
                    min: 1,
                    max: 5,
                    ticks: { stepSize: 1 }
                }
            }
        }
    });
}

function graficoMedia() {
    const area = document.getElementById("area-graficos");

    if (todosOsGraficos.length === 0) return;

    // Calcular a média
    let soma = [0, 0, 0, 0, 0];
    todosOsGraficos.forEach(grafico => {
        grafico.data.forEach((valor, i) => soma[i] += valor);
    });
    let mediaData = soma.map(v => v / todosOsGraficos.length);

    // Criar elementos
    const cartaContainer = document.createElement("div");
    cartaContainer.className = "atleta-carta";

    const infoTexto = document.createElement("p");
    infoTexto.textContent = "Média Geral de Status dos Atletas";

    ///////////////
    
    ////////////////

    const canvasContainer = document.createElement("div");
    canvasContainer.className = "grafico-container";

    const canvas = document.createElement("canvas");
    canvasContainer.appendChild(canvas);

    cartaContainer.appendChild(infoTexto);
    cartaContainer.appendChild(canvasContainer);
    area.appendChild(cartaContainer);

    // Criar o gráfico
    criarGraficoMedia("Média Geral", mediaData, canvas);
}

async function carregarAtletasEDesenharGraficos() {
    try {
        const resposta = await fetch("http://localhost:8001/atletas");
        const atletas = await resposta.json();

        atletas.forEach(atleta => criarGrafico(atleta));

        graficoMedia(); // Chama depois de todos os gráficos individuais
    } catch (erro) {
        console.error("Erro ao carregar atletas:", erro);
    }
}

window.addEventListener("DOMContentLoaded", carregarAtletasEDesenharGraficos);

    </script>

    
<footer>
    <a href="https://github.com/Teylorrrr" id="footer_copyright" target="_blank" style="text-decoration: none; color: inherit;">
      &#169; 2023 Desenvolvimento por Teylor 1023B
    </a>    
  </footer>
</body>
</html>