<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="style.css" rel="stylesheet" />
  <title>Comparar Atletas</title>
</head>
<body>
  <header>
    <i class="fa-regular fa-face-smile" style="color: #dedede;"></i>
    <h1>CADASTRE SEU ATLETA</h1>
    <nav>
      <a href="index.html">ATLETAS</a>
      <a href="cadastro.html">CADASTRE</a>
      <a href="comparar.html">COMPARAR</a>
      <a href="destaques.html">DESTAQUES</a>
      <a href="listar.html">LISTA</a>
    </nav>
  </header>

  <main>
    <section>
      <h2>Comparar Atletas</h2>
      <div class="comparar-form">
        <label for="atleta1">Primeiro atleta (ID):</label>
        <select id="atleta1"></select>

        <label for="atleta2">Segundo atleta (ID):</label>
        <select id="atleta2"></select>

        <button onclick="comparar()">Comparar</button>
        <button onclick="limparTodosGraficoComparacao()">Limpar Gráficos</button>
      </div>

      <!-- Aqui acumulamos as cartas de comparação -->
      <div id="area-graficos"></div>
    </section>
  </main>

  <script>
    // 1) Preenche os selects
    async function carregarAtletas() {
      try {
        const resp = await fetch("http://localhost:8001/atletas");
        const atletas = await resp.json();
        const sel1 = document.getElementById("atleta1");
        const sel2 = document.getElementById("atleta2");
        atletas.forEach(a => {
          const opt = new Option(`${a.id} – ${a.nome}`, a.id);
          sel1.add(opt.cloneNode(true));
          sel2.add(opt.cloneNode(true));
        });
      } catch (e) {
        console.error(e);
        alert("Erro ao carregar atletas.");
      }
    }

    // 2) Busca todos e filtra no front
    async function buscarAtletaPorId(id) {
      const resp = await fetch("http://localhost:8001/atletas");
      if (!resp.ok) throw new Error();
      const atletas = await resp.json();
      return atletas.find(a => String(a.id) === String(id)) || null;
    }

    // 3) Cada comparar() gera UMA NOVA carta com seu gráfico
    async function comparar() {
      const id1 = document.getElementById("atleta1").value;
      const id2 = document.getElementById("atleta2").value;
      if (!id1 || !id2 || id1 === id2) {
        alert("Selecione dois atletas diferentes.");
        return;
      }

      const at1 = await buscarAtletaPorId(id1);
      const at2 = await buscarAtletaPorId(id2);
      if (!at1 || !at2) return;

      // cria container da carta
      const carta = document.createElement("div");
      carta.className = "atleta-carta";

      // info do atleta
      const info = document.createElement("div");
      info.className = "atleta-info";
      info.innerHTML = `
        <p><strong>${at1.nome}</strong> vs <strong>${at2.nome}</strong></p>
        <p><strong>ID:</strong> ${at1.id} vs ${at2.id}</p>
      `;

      // container do gráfico
      const grafContainer = document.createElement("div");
      grafContainer.className = "grafico-container";
      const canvas = document.createElement("canvas");
      grafContainer.appendChild(canvas);

      carta.appendChild(info);
      carta.appendChild(grafContainer);
      document.getElementById("area-graficos").appendChild(carta);

      // prepara dados
      const labels = ["Força","Resistência","Velocidade","Impulsão","Arremesso"];
      const dados1 = [at1.forca, at1.resistencia, at1.velocidade, at1.impulsao, at1.arremesso];
      const dados2 = [at2.forca, at2.resistencia, at2.velocidade, at2.impulsao, at2.arremesso];

      // desenha gráfico novo
      new Chart(canvas.getContext("2d"), {
        type: 'radar',
        data: {
          labels,
          datasets: [
            { label: at1.nome, data: dados1, fill: true, backgroundColor:"rgba(255,99,132,0.2)", borderColor:"rgb(255,99,132)" },
            { label: at2.nome, data: dados2, fill: true, backgroundColor:"rgba(54,162,235,0.2)", borderColor:"rgb(54,162,235)" }
          ]
        },
        options: {
          responsive: true,
          scales: { r: { beginAtZero:true, min:1, max:5, ticks:{ stepSize:1 } } }
        }
      });
    }

    // 4) Limpa todas as comparações
    function limparTodosGraficoComparacao() {
      document.getElementById("area-graficos").innerHTML = "";
    }

    window.addEventListener("DOMContentLoaded", carregarAtletas);
  </script>
  
  <footer>
    <div id="footer_copyright">
      &#169 2023 Desenvolvimento por Teylor 1023B
    </div>
  </footer>
</body>
</html>
