<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="style.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" />
  <title>Comparar Atletas</title>
</head>
<body>
  <header>
    <i class="fa-regular fa-face-smile" style="color: #dedede;"></i>
    <h1>CADASTRE SEU ATLETA</h1>
    <nav>
      <a href="index.html">ATLETAS</a>
      <a href="cadastro.html">CADASTRE</a>
      <a href="comparar.html">COMPARAR</a>
      <a href="destaques.html">DESTAQUES</a>
      <a href="listar.html">LISTA</a>
    </nav>
  </header>

  <h2>Comparar Atletas</h2>
  <section class="comparar-form">
    <label for="atleta1">Primeiro atleta:</label>
    <select id="atleta1"></select>

    <label for="atleta2">Segundo atleta:</label>
    <select id="atleta2"></select>

    <button onclick="comparar()">Comparar</button>
    <button onclick="limparGraficoComparacao()">Limpar Gráfico</button>

    <div id="grafico-comparacao" class="atleta-carta"></div>
  </section>

  <h2>Atletas Cadastrados</h2>
  <div id="area-graficos"></div>

  <script>
    const todosOsGraficos = [];

    function criarGrafico(atleta) {
      const area = document.getElementById("area-graficos");

      const cartaContainer = document.createElement("div");
      cartaContainer.className = "atleta-carta";

      const infoTexto = document.createElement("div");
      infoTexto.className = "atleta-info";
      infoTexto.innerHTML = `
        <p><strong>ID:</strong> ${atleta.id}</p>
        <p><strong>Nome:</strong> ${atleta.nome}</p>
        <p><strong>Idade:</strong> ${atleta.idade}</p>
        <p><strong>Altura:</strong> ${atleta.altura} m</p>
      `;

      const canvasContainer = document.createElement("div");
      canvasContainer.className = "grafico-container";
      const canvas = document.createElement("canvas");

      canvasContainer.appendChild(canvas);
      cartaContainer.appendChild(infoTexto);
      cartaContainer.appendChild(canvasContainer);
      area.appendChild(cartaContainer);

      const ctx = canvas.getContext("2d");

      const dados = [
        parseInt(atleta.forca) || 0,
        parseInt(atleta.resistencia) || 0,
        parseInt(atleta.velocidade) || 0,
        parseInt(atleta.impulsao) || 0,
        parseInt(atleta.arremesso) || 0
      ];

      todosOsGraficos.push({ nome: atleta.nome, data: dados });

      new Chart(ctx, {
        type: "radar",
        data: {
          labels: ["Força", "Resistência", "Velocidade", "Impulsão", "Arremesso"],
          datasets: [{
            label: atleta.nome,
            data: dados,
            backgroundColor: "rgba(54, 162, 235, 0.2)",
            borderColor: "rgba(54, 162, 235, 1)",
            pointBackgroundColor: "rgba(54, 162, 235, 1)"
          }]
        },
        options: {
          responsive: true,
          scales: {
            r: { min: 1, max: 5, ticks: { stepSize: 1 } }
          }
        }
      });
    }

    function criarGraficoMedia(nome, dados, canvas) {
      const ctx = canvas.getContext("2d");
      new Chart(ctx, {
        type: "radar",
        data: {
          labels: ["Força", "Resistência", "Velocidade", "Impulsão", "Arremesso"],
          datasets: [{
            label: nome,
            data: dados,
            backgroundColor: "rgba(255, 99, 132, 0.2)",
            borderColor: "rgba(255, 99, 132, 1)",
            pointBackgroundColor: "rgba(255, 99, 132, 1)"
          }]
        },
        options: {
          responsive: true,
          scales: {
            r: { min: 1, max: 5, ticks: { stepSize: 1 } }
          }
        }
      });
    }

    function graficoMedia() {
      const area = document.getElementById("area-graficos");
      if (todosOsGraficos.length === 0) return;

      let soma = [0, 0, 0, 0, 0];
      todosOsGraficos.forEach(grafico => {
        grafico.data.forEach((valor, i) => soma[i] += valor);
      });
      let mediaData = soma.map(v => v / todosOsGraficos.length);

      const cartaContainer = document.createElement("div");
      cartaContainer.className = "atleta-carta";

      const infoTexto = document.createElement("p");
      infoTexto.textContent = "Média Geral de Status dos Atletas";

      const canvasContainer = document.createElement("div");
      canvasContainer.className = "grafico-container";

      const canvas = document.createElement("canvas");
      canvasContainer.appendChild(canvas);

      cartaContainer.appendChild(infoTexto);
      cartaContainer.appendChild(canvasContainer);
      area.appendChild(cartaContainer);

      criarGraficoMedia("Média Geral", mediaData, canvas);
    }

    async function carregarAtletasEDesenharGraficos() {
      try {
        const resposta = await fetch("http://localhost:8001/atletas");
        const atletas = await resposta.json();

        const sel1 = document.getElementById("atleta1");
        const sel2 = document.getElementById("atleta2");

        atletas.forEach(atleta => {
          criarGrafico(atleta);

          const opt1 = new Option(`${atleta.nome} (${atleta.id})`, atleta.id);
          const opt2 = new Option(`${atleta.nome} (${atleta.id})`, atleta.id);
          sel1.add(opt1);
          sel2.add(opt2);
        });

        graficoMedia();
      } catch (erro) {
        console.error("Erro ao carregar atletas:", erro);
      }
    }

    let comparacaoChart = null;

    async function comparar() {
      const id1 = document.getElementById("atleta1").value;
      const id2 = document.getElementById("atleta2").value;
      if (!id1 || !id2 || id1 === id2) {
        alert("Selecione dois atletas diferentes.");
        return;
      }

      const resposta = await fetch("http://localhost:8001/atletas");
      const atletas = await resposta.json();
      const atleta1 = atletas.find(a => a.id == id1);
      const atleta2 = atletas.find(a => a.id == id2);

      if (!atleta1 || !atleta2) return;

      const dados1 = [atleta1.forca, atleta1.resistencia, atleta1.velocidade, atleta1.impulsao, atleta1.arremesso];
      const dados2 = [atleta2.forca, atleta2.resistencia, atleta2.velocidade, atleta2.impulsao, atleta2.arremesso];

      const container = document.getElementById("grafico-comparacao");
      container.innerHTML = ""; // limpa conteúdo anterior

      const canvas = document.createElement("canvas");
      container.appendChild(canvas);

      if (comparacaoChart) comparacaoChart.destroy();
      comparacaoChart = new Chart(canvas, {
        type: 'radar',
        data: {
          labels: ["Força", "Resistência", "Velocidade", "Impulsão", "Arremesso"],
          datasets: [
            {
              label: atleta1.nome,
              data: dados1,
              backgroundColor: "rgba(255,99,132,0.2)",
              borderColor: "rgb(255,99,132)"
            },
            {
              label: atleta2.nome,
              data: dados2,
              backgroundColor: "rgba(54,162,235,0.2)",
              borderColor: "rgb(54,162,235)"
            }
          ]
        },
        options: {
          responsive: true,
          scales: { r: { beginAtZero: true, min: 1, max: 5, ticks: { stepSize: 1 } } }
        }
      });
    }

    function limparGraficoComparacao() {
      if (comparacaoChart) comparacaoChart.destroy();
      document.getElementById("grafico-comparacao").innerHTML = "";
    }

    window.addEventListener("DOMContentLoaded", carregarAtletasEDesenharGraficos);
  </script>

  <footer>
    <div id="footer_copyright">
      &#169 2023 Desenvolvimento por Teylor 1023B
    </div>
  </footer>
</body>
</html>
